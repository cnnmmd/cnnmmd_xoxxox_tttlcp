FROM ubuntu:22.04

ENV OPTAPT=""
#ENV OPTAPT="-o Acquire::AllowInsecureRepositories=true -o Acquire::AllowDowngradeToInsecureRepositories=true"
RUN \
  apt-get ${OPTAPT} -y update && \
  apt-get ${OPTAPT} -y upgrade && \
  apt-get ${OPTAPT} -y install python3 python3-pip python-is-python3 && \
  apt-get ${OPTAPT} -y install build-essential cmake ninja-build libopenblas-dev && \
  rm -rf /var/lib/apt/lists/*
RUN ARC=$(uname -m) && \
  if test "${ARC}" = 'x86_64'; \
  then \
    CMAKE_ARGS='-DLLAMA_BLAS=ON -DLLAMA_BLAS_VENDOR=Intel10_64lp' \
    pip3 install --no-cache-dir llama-cpp-python; \
  fi; \
  if test "${ARC}" = 'aarch64'; \
  then \
    CMAKE_ARGS='-DLLAMA_BLAS=ON -DLLAMA_BLAS_VENDOR=OpenBLAS' \
    pip3 install --no-cache-dir llama-cpp-python; \
  fi
RUN pip3 install --no-cache-dir aiohttp
